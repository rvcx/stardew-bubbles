<html>
<h1>Stardew Valley Fishing Bubble Predictor</h1>
Game ID: <input placeholder="(end of save file name)" id="seed" />
Day <input type="number" min="1" max="28" value="1" id="day" />
of <select id="month">
  <option value="0" default>Spring</option>
  <option value="1">Summer</option>
  <option value="2">Fall</option>
  <option value="3">Winter</option>
</select>
Year <input type="number" min="1" value="1" id="year" />
<select id="location"></select>

<div id="container">
  <img id="image" src="beach.png" />
  <div id="splashes">
  </div>
</div>

<style>
* { font-family: courier }
#year { width: 3em }
#container { position: relative }
#image {
  position: absolute
  left: 0
  top: 0
}
.splash {
  z-index: 100;
  display: -webkit-flex;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  position: absolute;
  color: white;
  width: 44px;
  height: 44px;
  border: 2px solid;
  padding: 0;
  margin: 0;
  border-radius: 16px;
  font-family: 'Courier New', monospace;
  font-size: 10px;
  font-weight: bold;
  vertical-align: middle;
  background-color: black;
  opacity: 0.4;
}
</style>

<script>
function rng(seed) {
  "use strict"
  let imax = 2147483647
  var seeds = []
  var mj = 161803398 - Math.abs(parseInt(seed))
  seeds[55] = mj
  var mk = 1
  for (var i = 1; i < 55; ++i) {
    var ii = (21 * i) % 55
    seeds[ii] = mk
    mk = mj - mk
    if (mk < 0) { mk += imax }
    mj = seeds[ii]
  }
  for (var j = 0; j < 4; ++j) {
    for (var i = 1; i < 56; ++i) {
      seeds[i] -= seeds[1 + (i + 30) % 55]
      if (seeds[i] > imax) { seeds[i] -= (imax * 2 + 1) }
      if (seeds[i] < 0) { seeds[i] += imax }
    }
  }
  var inext = 0
  var ip = 21
  return function () {
    inext %= 55
    ip %= 55
    ++inext;
    ++ip;
    var r = seeds[inext] - seeds[ip]
    if (r == imax) { r -= 1 }
    if (r < 0) { r += imax }
    seeds[inext] = r
    return r / imax
  }
}

function bubbles(gid, day, width, height, candidates) {
  var t = 600
  function step_t() { t += (t % 100 == 50) ? 50 : 10 }
  function spawn() {
    let r = rng(gid / 2 + day + t)
    if (r() < 0.5) {
      for (var i = 0; i < 2; ++i) {
        c = [parseInt(width * r()), parseInt(height * r())]
        if (candidates.has(JSON.stringify(c))) { return c }
      }
    }
    return null
  }
  function maintain() { return rng(gid / 2 + day + t)() >= 0.1 }
  out = []
  while (t < 2600) {
    let b = spawn()
    if (b != null) {
      let start = t
      do { step_t() } while (maintain())
      out.push([start, t, b])
      step_t()
    } else {
      step_t()
    }
  }
  return out
}

let locations = [
// Name, imgurl, width, height, set-of-stringified-bubble-candidate-coords
["Beach", "beach.png", 104, 50, new Set([[15, 21], [58, 1], [7, 17], [15, 30], [90, 33], [7, 26], [18, 26], [82, 29], [61, 6], [63, 25], [7, 35], [18, 35], [94, 3], [48, 36], [26, 39], [79, 42], [90, 42], [60, 10], [94, 12], [91, 25], [8, 18], [60, 19], [94, 21], [91, 34], [21, 37], [83, 30], [75, 26], [94, 39], [95, 4], [95, 13], [95, 22], [33, 38], [44, 38], [64, 25], [22, 28], [45, 30], [37, 26], [67, 27], [22, 37], [78, 36], [14, 42], [7, 12], [79, 28], [90, 28], [7, 21], [18, 21], [79, 37], [7, 30], [48, 31], [82, 33], [40, 27], [48, 40], [60, 5], [94, 7], [6, 34], [82, 42], [60, 14], [94, 16], [0, 9], [91, 29], [21, 32], [60, 23], [94, 25], [6, 43], [94, 34], [41, 28], [52, 28], [95, 8], [33, 24], [93, 38], [85, 43], [25, 38], [3, 10], [34, 25], [56, 25], [22, 32], [86, 44], [70, 27], [78, 40], [47, 34], [17, 39], [28, 39], [7, 16], [90, 32], [48, 26], [68, 27], [71, 28], [29, 22], [63, 24], [82, 28], [60, 0], [94, 2], [48, 35], [60, 9], [94, 11], [21, 27], [6, 38], [29, 40], [60, 18], [94, 20], [21, 36], [40, 40], [41, 32], [44, 28], [93, 42], [22, 27], [67, 26], [78, 26], [59, 22], [78, 35], [78, 44], [89, 44], [36, 38], [47, 38], [17, 34], [7, 11], [9, 30], [79, 27], [90, 27], [17, 43], [6, 15], [48, 30], [82, 32], [40, 26], [63, 28], [48, 39], [60, 4], [94, 6], [6, 33], [81, 36], [60, 13], [94, 15], [21, 31], [6, 42], [60, 22], [21, 40], [52, 27], [2, 8], [93, 28], [33, 23], [93, 37], [85, 42], [3, 9], [13, 41], [59, 8], [16, 37], [59, 17], [55, 28], [59, 26], [70, 26], [78, 39], [17, 20], [47, 33], [17, 29], [9, 25], [17, 38], [28, 38], [92, 41], [9, 34], [6, 10], [9, 43], [6, 19], [48, 34], [60, 8], [21, 26], [62, 27], [6, 37], [21, 35], [93, 23], [20, 39], [51, 26], [74, 28], [93, 41], [32, 22], [97, 2], [43, 31], [32, 40], [43, 40], [59, 3], [16, 32], [16, 41], [59, 21], [47, 28], [92, 27], [47, 37], [9, 20], [17, 33], [92, 36], [9, 29], [17, 42], [80, 43], [6, 14], [29, 25], [81, 26], [60, 3], [81, 35], [21, 30], [39, 29], [81, 44], [54, 27], [39, 38], [20, 34], [93, 27], [23, 39], [93, 36], [43, 26], [66, 28], [16, 27], [24, 40], [59, 7], [35, 40], [16, 36], [88, 43], [59, 16], [55, 27], [5, 8], [59, 25], [5, 17], [47, 32], [17, 28], [92, 31], [9, 24], [17, 37], [80, 38], [92, 40], [9, 33], [6, 9], [6, 18], [42, 39], [62, 26], [73, 26], [20, 29], [93, 22], [20, 38], [31, 38], [74, 27], [12, 43], [97, 1], [43, 30], [35, 26], [32, 39], [43, 39], [59, 2], [16, 31], [59, 11], [16, 40], [5, 12], [58, 15], [47, 27], [77, 28], [58, 24], [92, 26], [9, 19], [61, 20], [92, 35], [9, 28], [80, 42], [92, 44], [6, 13], [8, 32], [8, 41], [81, 34], [39, 28], [31, 24], [54, 26], [20, 33], [84, 36], [96, 10], [23, 38], [96, 19], [1, 10], [16, 26], [46, 27], [88, 42], [16, 35], [46, 36], [58, 10], [5, 16], [58, 19], [61, 15], [69, 28], [80, 28], [92, 30], [61, 24], [80, 37], [92, 39], [8, 27], [19, 27], [42, 29], [27, 40], [91, 43], [8, 36], [42, 38], [62, 25], [11, 41], [20, 28], [4, 11], [84, 31], [20, 37], [96, 5], [96, 14], [12, 42], [34, 39], [45, 39], [35, 25], [65, 26], [76, 26], [16, 21], [57, 22], [16, 30], [46, 31], [38, 27], [49, 27], [46, 40], [58, 5], [15, 34], [61, 1], [5, 11], [77, 27], [61, 10], [15, 43], [58, 23], [92, 25], [7, 39], [61, 19], [18, 39], [50, 28], [80, 41], [8, 22], [30, 22], [8, 31], [83, 34], [8, 40], [30, 40], [83, 43], [94, 43], [95, 17], [39, 27], [31, 23], [84, 26], [95, 26], [20, 32], [84, 35], [96, 0], [84, 44], [96, 9], [96, 18], [1, 9], [37, 39], [46, 26], [57, 26], [68, 26], [15, 20], [46, 35], [58, 0], [15, 29], [58, 9], [7, 25], [26, 38], [61, 5], [38, 40], [58, 18], [7, 34], [18, 34], [79, 41], [58, 27], [69, 27], [80, 27], [61, 23], [7, 43], [18, 43], [8, 17], [91, 33], [8, 26], [19, 26], [42, 28], [83, 29], [27, 39], [8, 35], [94, 38], [95, 3], [91, 42], [95, 12], [95, 21], [4, 10], [72, 28], [84, 30], [96, 4], [96, 13], [87, 44], [96, 22], [22, 36], [34, 38], [45, 38], [14, 41], [57, 21], [46, 30], [38, 26], [49, 26], [46, 39], [58, 4], [7, 20], [15, 33], [61, 0], [79, 36], [7, 29], [90, 36], [15, 42], [61, 9], [7, 38], [18, 38], [61, 18], [0, 8], [91, 28], [8, 21], [94, 24], [8, 30], [83, 33], [41, 27], [83, 42], [95, 7], [94, 42], [95, 16], [44, 32], [95, 25], [84, 34], [53, 28], [64, 28], [96, 8], [34, 24], [56, 24], [22, 31], [37, 29], [22, 40], [86, 43], [37, 38], [57, 25], [15, 19], [7, 15], [15, 28], [90, 31], [58, 8], [7, 24], [71, 27], [61, 4], [82, 27], [7, 33], [18, 33], [82, 36], [79, 40], [7, 42], [18, 42], [94, 10], [29, 39], [40, 39], [60, 17], [94, 19], [91, 32], [60, 26], [83, 28], [94, 37], [95, 2], [41, 31], [95, 11], [44, 27], [41, 40], [95, 20], [4, 9], [72, 27], [10, 43], [96, 3], [22, 26], [45, 28], [56, 28], [22, 35], [78, 34], [78, 43], [89, 43], [57, 20], [7, 10], [79, 26], [90, 26], [7, 19], [15, 32], [79, 35], [90, 35], [7, 28], [18, 28], [82, 31], [79, 44], [63, 27], [7, 37], [18, 37], [94, 5], [48, 38], [90, 44], [60, 12], [94, 14], [91, 27], [6, 41], [60, 21], [94, 23], [21, 39], [83, 32], [41, 26], [52, 26], [75, 28], [95, 6], [95, 15], [44, 31], [33, 40], [44, 40], [53, 27], [3, 8], [64, 27], [22, 30], [45, 32], [37, 28], [22, 39], [86, 42], [78, 38], [15, 18], [7, 14], [90, 30], [7, 23], [71, 26], [82, 26], [79, 39], [9, 42], [48, 33], [82, 35], [40, 29], [82, 44], [60, 7], [94, 9], [6, 36], [29, 38], [40, 38], [60, 16], [94, 18], [21, 34], [60, 25], [83, 27], [94, 27], [95, 1], [41, 30], [44, 26], [41, 39], [93, 40], [10, 42], [25, 40], [59, 20], [36, 27], [78, 42], [89, 42], [47, 36], [17, 32], [7, 9], [17, 41], [79, 34], [90, 34], [48, 28], [82, 30], [29, 24], [63, 26], [48, 37], [60, 2], [94, 4], [60, 11], [94, 13], [21, 29], [6, 40], [81, 43], [60, 20], [21, 38], [93, 26], [93, 35], [44, 30], [93, 44], [66, 27], [24, 39], [59, 6], [35, 39], [59, 15], [55, 26], [67, 28], [78, 28], [59, 24], [78, 37], [47, 31], [17, 27], [36, 40], [9, 23], [47, 40], [17, 36], [9, 32], [6, 8], [9, 41], [6, 17], [48, 32], [40, 28], [60, 6], [94, 8], [6, 35], [60, 15], [21, 33], [93, 21], [2, 10], [74, 26], [93, 39], [97, 0], [43, 29], [85, 44], [32, 38], [43, 38], [59, 1], [13, 43], [59, 10], [16, 39], [59, 19], [36, 26], [47, 26], [70, 28], [47, 35], [9, 18], [17, 31], [92, 34], [9, 27], [17, 40], [28, 40], [92, 43], [6, 12], [48, 27], [29, 23], [60, 1], [21, 28], [6, 39], [81, 42], [93, 25], [93, 34], [51, 28], [93, 43], [32, 24], [66, 26], [97, 4], [24, 38], [59, 5], [35, 38], [16, 34], [55, 25], [78, 27], [16, 43], [59, 23], [5, 15], [47, 30], [17, 26], [92, 29], [36, 39], [9, 22], [47, 39], [17, 35], [80, 36], [92, 38], [9, 31], [6, 16], [81, 28], [62, 24], [20, 27], [39, 40], [93, 20], [20, 36], [2, 9], [12, 41], [43, 28], [16, 20], [59, 0], [16, 29], [13, 42], [59, 9], [16, 38], [59, 18], [5, 10], [77, 26], [5, 19], [17, 21], [58, 22], [92, 24], [17, 30], [92, 33], [9, 26], [50, 27], [61, 27], [80, 40], [92, 42], [9, 35], [6, 11], [42, 32], [6, 20], [8, 39], [30, 39], [39, 26], [62, 28], [73, 28], [31, 22], [20, 31], [93, 24], [20, 40], [31, 40], [84, 43], [96, 17], [51, 27], [1, 8], [32, 23], [97, 3], [43, 32], [59, 4], [16, 33], [46, 34], [16, 42], [38, 39], [5, 14], [58, 17], [58, 26], [69, 26], [9, 21], [61, 22], [80, 26], [92, 28], [80, 35], [92, 37], [80, 44], [8, 25], [42, 27], [27, 38], [8, 34], [81, 27], [8, 43], [62, 23], [20, 26], [54, 28], [84, 29], [39, 39], [20, 35], [96, 12], [23, 40], [87, 43], [96, 21], [43, 27], [16, 19], [16, 28], [88, 44], [46, 38], [58, 3], [5, 9], [15, 41], [61, 8], [5, 18], [58, 21], [61, 17], [92, 32], [50, 26], [61, 26], [80, 39], [8, 20], [91, 36], [8, 29], [42, 31], [8, 38], [30, 38], [42, 40], [94, 41], [73, 27], [11, 43], [95, 24], [20, 30], [84, 33], [31, 39], [84, 42], [96, 7], [96, 16], [65, 28], [76, 28], [57, 24], [46, 33], [15, 27], [38, 29], [58, 7], [38, 38], [61, 3], [5, 13], [58, 16], [7, 32], [58, 25], [7, 41], [18, 41], [61, 21], [80, 34], [91, 31], [8, 24], [30, 24], [42, 26], [8, 33], [83, 36], [94, 36], [8, 42], [95, 10], [95, 19], [4, 8], [72, 26], [84, 28], [96, 2], [96, 11], [45, 27], [56, 27], [87, 42], [96, 20], [22, 34], [46, 28], [57, 28], [68, 28], [46, 37], [58, 2], [7, 18], [15, 31], [58, 11], [7, 27], [18, 27], [61, 7], [26, 40], [58, 20], [7, 36], [18, 36], [61, 16], [79, 43], [90, 43], [61, 25], [91, 26], [8, 19], [94, 22], [91, 35], [8, 28], [19, 28], [42, 30], [83, 31], [75, 27], [8, 37], [94, 40], [95, 5], [91, 44], [95, 14], [11, 42], [95, 23], [33, 39], [44, 39], [84, 32], [53, 26], [64, 26], [96, 6], [96, 15], [22, 29], [45, 31], [37, 27], [22, 38], [34, 40], [45, 40], [65, 27], [76, 27], [14, 43], [57, 23], [46, 32], [7, 13], [15, 26], [38, 28], [49, 28], [58, 6], [7, 22], [90, 29], [61, 2], [15, 35], [7, 31], [82, 34], [79, 38], [61, 11], [7, 40], [18, 40], [82, 43], [94, 17], [0, 10], [91, 30], [8, 23], [30, 23], [60, 24], [83, 26], [94, 26], [83, 35], [95, 0], [94, 35], [41, 29], [83, 44], [95, 9], [94, 44], [41, 38], [95, 18], [84, 27], [10, 41], [25, 39], [96, 1], [45, 26], [56, 26], [22, 33], [37, 40], [78, 41], [57, 27]].map(JSON.stringify))]
]

function locOption(i) {
  return '<option value="' + i + '">' + locations[i][0] + '</option>'
}
document.getElementById("location").innerHTML
  = [...Array(locations.length).keys()].map(locOption).join("\n")

function time_as_string(t) {
  return parseInt(t / 100).toString() + ":" + ("0" + (t % 100)).slice(-2)
}

function updateValue(e) {
  const container = document.getElementById("splashes")
  gid = parseInt(document.getElementById("seed").value)
  mday = parseInt(document.getElementById("day").value)
  month = parseInt(document.getElementById("month").value)
  year = parseInt(document.getElementById("year").value)
  locIndex = parseInt(document.getElementById("location").value)
  day = (year - 1) * 28 * 4 + month * 28 + mday
  loc = locations[locIndex]
  function formatDiv(b) {
    return '<div class="splash" style="top:' + (b[2][1] - 1) * 16 + 'px;left:' + (b[2][0] - 1) * 16 + 'px">'
      + time_as_string(b[0]) + '<br>to<br>' + time_as_string(b[1])
      + '</div>'
  }
  bs = bubbles(gid, day, loc[2], loc[3], loc[4])
  document.getElementById("image").src = loc[1]
  container.innerHTML = bs.map(formatDiv).join("\n")
}

let inputs = ["seed", "day", "month", "year", "location"]
for (let i = 0; i < inputs.length; ++i) {
  const input = document.getElementById(inputs[i]);
  input.addEventListener("change", updateValue);
}
</script>

</html>