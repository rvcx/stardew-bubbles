<html>
<h1>Stardew Valley Fishing Bubble Predictor</h1>
Game ID: <input placeholder="(end of save file name)" id="seed" />
Day <input type="number" min="1" max="28" value="1" id="day" />
of <select id="month">
  <option value="0" default>Spring</option>
  <option value="1">Summer</option>
  <option value="2">Fall</option>
  <option value="3">Winter</option>
</select>
Year <input type="number" min="1" value="1" id="year" />
<select id="location"></select>

<div id="container">
  <img id="image" src="beach.png" />
  <div id="splashes">
  </div>
</div>

Inaccurate prediction?
<a href="https://github.com/rvcx/stardew-bubbles/issues">Report an issue!</a>

<style>
* { font-family: courier }
#year { width: 3em }
#container { position: relative }
#image {
  position: absolute
  left: 0
  top: 0
}
.splash {
  z-index: 100;
  display: -webkit-flex;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  position: absolute;
  color: white;
  width: 44px;
  height: 44px;
  border: 2px solid;
  padding: 0;
  margin: 0;
  border-radius: 16px;
  font-family: 'Courier New', monospace;
  font-size: 10px;
  font-weight: bold;
  vertical-align: middle;
  background-color: black;
  opacity: 0.4;
}
</style>

<script>
function rng(seed) {
  "use strict"
  let imax = 2147483647
  var seeds = []
  var mj = 161803398 - Math.abs(parseInt(seed))
  seeds[55] = mj
  var mk = 1
  for (var i = 1; i < 55; ++i) {
    var ii = (21 * i) % 55
    seeds[ii] = mk
    mk = mj - mk
    if (mk < 0) { mk += imax }
    mj = seeds[ii]
  }
  for (var j = 0; j < 4; ++j) {
    for (var i = 1; i < 56; ++i) {
      seeds[i] -= seeds[1 + (i + 30) % 55]
      if (seeds[i] > imax) { seeds[i] -= (imax * 2 + 1) }
      if (seeds[i] < 0) { seeds[i] += imax }
    }
  }
  var inext = 0
  var ip = 21
  return function () {
    inext %= 55
    ip %= 55
    ++inext;
    ++ip;
    var r = seeds[inext] - seeds[ip]
    if (r == imax) { r -= 1 }
    if (r < 0) { r += imax }
    seeds[inext] = r
    return r / imax
  }
}

function bubbles(gid, day, width, height, candidates) {
  var t = 600
  function step_t() { t += (t % 100 == 50) ? 50 : 10 }
  function spawn() {
    let r = rng(gid / 2 + day + t)
    if (r() < 0.5) {
      for (var i = 0; i < 2; ++i) {
        c = [parseInt(width * r()), parseInt(height * r())]
        if (candidates.has(JSON.stringify(c))) { return c }
      }
    }
    return null
  }
  function maintain() { return rng(gid / 2 + day + t)() >= 0.1 }
  out = []
  while (t < 2600) {
    let b = spawn()
    if (b != null) {
      let start = t
      do { step_t() } while (t < 2600 && maintain())
      out.push([start, t, b])
      step_t()
    } else {
      step_t()
    }
  }
  return out
}

let locations = [
// Name, imgurl, width, height, set-of-stringified-bubble-candidate-coords
  ["Beach", "beach.png", 104, 50, new Set([
    [7,26], [82,29], [26,39], [79,42], [7,35], [18,35], [48,36], [60,10],
    [60,19], [94,21], [91,34], [21,37], [83,30], [94,39], [95,4],
    [95,13], [95,22], [45,30], [67,27], [78,36], [14,42], [79,28],
    [7,21], [79,37], [7,30], [48,31], [82,33], [40,27], [48,40],
    [60,5], [6,34], [21,32], [91,29], [6,43], [60,23], [94,25],
    [94,34], [41,28], [52,28], [95,8], [93,38], [85,43], [3,10],
    [86,44], [70,27], [78,40], [47,34], [17,39], [28,39], [71,28],
    [82,28], [48,35], [60,9], [21,27], [6,38], [29,40], [40,40],
    [60,18], [21,36], [44,28], [93,42], [59,22], [78,35], [78,44],
    [89,44], [47,38], [17,34], [79,27], [17,43], [6,15], [48,30],
    [82,32], [63,28], [48,39], [60,4], [6,33], [21,31], [6,42],
    [60,22], [21,40], [52,27], [93,28], [93,37], [3,9], [59,8],
    [59,17], [55,28], [59,26], [78,39], [47,33], [17,29], [17,38],
    [6,10], [9,43], [6,19], [48,34], [60,8], [62,27], [6,37], [21,35],
    [20,39], [74,28], [93,41], [97,2], [43,31], [32,40], [43,40],
    [59,3], [16,32], [59,21], [47,28], [92,27], [47,37], [17,33],
    [17,42], [80,43], [6,14], [60,3], [81,35], [21,30], [81,44],
    [54,27], [20,34], [93,27], [23,39], [93,36], [66,28], [16,27],
    [24,40], [59,7], [35,40], [88,43], [59,16], [55,27], [59,25],
    [5,17], [47,32], [17,28], [92,31], [17,37], [6,18], [42,39],
    [62,26], [20,29], [20,38], [74,27], [12,43], [43,30], [32,39],
    [43,39], [59,2], [16,31], [5,12], [47,27], [77,28], [58,24],
    [92,26], [92,35], [92,44], [6,13], [8,32], [81,34], [39,28],
    [20,33], [96,10], [57,27], [96,19], [46,27], [5,16], [69,28],
    [80,28], [92,30], [61,24], [8,27], [19,27], [42,29], [27,40],
    [91,43], [62,25], [20,28], [4,11], [20,37], [96,5], [96,14],
    [12,42], [34,39], [45,39], [16,30], [46,31], [38,27], [49,27],
    [46,40], [5,11], [77,27], [15,43], [58,23], [7,39], [18,39],
    [50,28], [8,22], [8,31], [83,34], [30,40], [83,43], [94,43],
    [95,17], [39,27], [31,23], [95,26], [20,32], [84,44], [96,9],
    [96,18], [37,39], [57,26], [7,25], [38,40], [79,41], [7,34],
    [18,34], [58,27], [69,27], [80,27], [7,43], [18,43], [91,33],
    [8,26], [42,28], [83,29], [27,39], [94,38], [95,3], [95,12],
    [95,21], [4,10], [72,28], [96,4], [96,13], [87,44], [96,22],
    [46,30], [46,39], [7,20], [79,36], [7,29], [15,42], [7,38],
    [18,38], [91,28], [8,21], [94,24], [8,30], [83,33], [41,27],
    [94,42], [95,7], [95,16], [95,25], [53,28], [64,28], [96,8],
    [22,40], [86,43], [57,25], [7,24], [71,27], [82,27], [79,40],
    [7,33], [18,33], [7,42], [18,42], [29,39], [40,39], [60,17],
    [91,32], [60,26], [83,28], [94,37], [44,27], [95,11], [41,40],
    [95,20], [4,9], [72,27], [10,43], [96,3], [45,28], [56,28],
    [78,34], [78,43], [89,43], [7,19], [79,35], [7,28], [18,28],
    [82,31], [79,44], [63,27], [7,37], [18,37], [48,38], [90,44],
    [91,27], [6,41], [60,21], [94,23], [21,39], [83,32], [75,28],
    [95,6], [95,15], [44,31], [33,40], [44,40], [53,27], [64,27],
    [22,39], [78,38], [7,23], [9,42], [79,39], [48,33], [82,35],
    [82,44], [60,7], [6,36], [60,16], [21,34], [60,25], [83,27],
    [94,27], [41,39], [93,40], [10,42], [25,40], [59,20], [78,42],
    [47,36], [17,32], [17,41], [79,34], [48,28], [82,30], [63,26],
    [48,37], [60,2], [21,29], [6,40], [81,43], [60,20], [21,38],
    [93,26], [93,35], [44,30], [93,44], [66,27], [24,39], [59,6],
    [35,39], [67,28], [78,28], [59,24], [78,37], [47,31], [17,27],
    [36,40], [47,40], [17,36], [6,17], [48,32], [40,28], [60,6],
    [6,35], [21,33], [2,10], [93,39], [43,29], [85,44], [13,43],
    [59,10], [59,19], [70,28], [47,35], [17,31], [92,34], [17,40],
    [28,40], [92,43], [6,12], [48,27], [21,28], [6,39], [93,25],
    [93,34], [51,28], [93,43], [97,4], [59,5], [16,34], [78,27],
    [16,43], [59,23], [5,15], [47,30], [92,29], [36,39], [47,39],
    [17,35], [6,16], [81,28], [20,27], [39,40], [20,36], [2,9],
    [43,28], [16,29], [13,42], [59,9], [59,18], [5,10], [5,19],
    [58,22], [17,30], [92,33], [50,27], [61,27], [6,11], [6,20],
    [30,39], [62,28], [73,28], [20,31], [20,40], [31,40], [84,43],
    [96,17], [51,27], [97,3], [59,4], [16,33], [16,42], [38,39],
    [5,14], [58,26], [92,28], [80,35], [80,44], [8,25], [42,27],
    [8,34], [81,27], [8,43], [54,28], [39,39], [20,35], [96,12],
    [23,40], [87,43], [96,21], [43,27], [16,28], [88,44], [5,9],
    [5,18], [58,21], [92,32], [61,26], [8,20], [8,29], [42,31],
    [42,40], [94,41], [73,27], [11,43], [95,24], [20,30], [31,39],
    [96,7], [96,16], [65,28], [76,28], [5,13], [7,32], [58,25],
    [7,41], [18,41], [80,34], [91,31], [8,24], [8,33], [94,36],
    [8,42], [95,10], [95,19], [96,2], [96,11], [45,27], [56,27],
    [96,20], [46,28], [57,28], [68,28], [7,18], [7,27], [18,27],
    [26,40], [79,43], [90,43], [7,36], [18,36], [61,25], [8,19],
    [94,22], [91,35], [8,28], [19,28], [42,30], [83,31], [75,27],
    [91,44], [94,40], [95,5], [95,14], [11,42], [95,23], [33,39],
    [44,39], [96,6], [96,15], [45,31], [34,40], [45,40], [65,27],
    [76,27], [14,43], [38,28], [49,28], [7,22], [79,38], [7,31],
    [82,34], [7,40], [18,40], [82,43], [91,30], [8,23], [30,23],
    [60,24], [94,26], [83,35], [94,35], [83,44], [95,9], [94,44],
    [95,18], [25,39], [56,26], [37,40], [78,41], [68,27]
  ].map(JSON.stringify))],
  ["Mountain", "mountain.png", 135, 41, new Set([
    [72,18], [73,17], [53,14], [55,11], [54,13], [72,27], [62,26],
    [53,23], [63,25], [47,16], [63,34], [56,28], [77,26], [51,16],
    [74,18], [52,15], [75,17], [60,28], [51,25], [61,27], [52,24],
    [75,26], [77,35], [49,16], [75,35], [72,20], [73,19], [76,36],
    [55,13], [62,28], [53,25], [64,25], [54,24], [63,27], [64,34],
    [63,36], [67,27], [51,18], [50,20], [52,17], [75,19], [46,13],
    [74,20], [61,29], [52,26], [75,28], [60,30], [49,18], [72,22],
    [71,24], [73,21], [76,38], [63,20], [45,14], [47,11], [56,14],
    [53,27], [54,26], [64,27], [77,21], [63,38], [50,13], [51,20],
    [52,19], [75,21], [60,32], [78,38], [61,31], [52,28], [75,30],
    [48,15], [76,31], [53,11], [71,26], [73,23], [63,22], [47,13],
    [62,32], [54,28], [77,23], [78,22], [51,13], [52,12], [58,28],
    [69,28], [51,22], [70,27], [52,21], [61,33], [75,32], [76,24],
    [72,17], [48,17], [76,33], [53,13], [54,12], [71,28], [62,25],
    [63,24], [63,33], [77,25], [78,24], [51,15], [50,17], [52,14],
    [77,34], [61,26], [52,23], [75,25], [65,26], [76,26], [73,18],
    [76,35], [63,17], [54,14], [63,26], [63,35], [77,36], [50,19],
    [52,16], [75,18], [64,36], [61,28], [52,25], [46,15], [48,12],
    [65,28], [76,28], [66,27], [71,23], [73,20], [76,37], [63,19],
    [45,13], [56,13], [54,25], [72,24], [63,37], [50,12], [67,28],
    [50,21], [52,18], [78,37], [64,38], [61,30], [52,27], [76,21],
    [48,14], [76,30], [49,13], [71,25], [63,21], [72,26], [77,22],
    [53,22], [47,15], [62,34], [55,28], [69,27], [52,20], [74,17],
    [61,32], [51,24], [76,23], [48,16], [76,32], [49,15], [75,34],
    [54,11], [57,28], [68,28], [63,23], [72,19], [55,12], [72,28],
    [62,27], [53,24], [78,23], [50,16], [52,13], [64,33], [59,28],
    [70,28], [51,17], [74,19], [46,12], [51,26], [65,25], [76,25],
    [75,27], [60,29], [76,34], [49,17], [72,21], [55,14], [62,29],
    [53,26], [78,25], [64,26], [50,18], [64,35], [51,19], [74,21],
    [75,20], [77,38], [46,14], [57,14], [65,27], [76,27], [75,29],
    [60,31], [63,18], [72,23], [73,22], [47,12], [53,28], [64,28],
    [54,27], [62,31], [64,37], [51,12], [51,21], [76,20], [75,22],
    [48,13], [76,29], [49,12], [66,28], [52,29], [75,31], [53,12],
    [72,25], [71,27], [73,24], [53,21], [47,14], [62,33], [77,24],
    [77,37], [51,14], [51,23], [76,22], [52,22], [61,34], [75,33],
    [68,27]
  ].map(JSON.stringify))]
]

function locOption(i) {
  return '<option value="' + i + '">' + locations[i][0] + '</option>'
}
document.getElementById("location").innerHTML
  = [...Array(locations.length).keys()].map(locOption).join("\n")

function time_as_string(t) {
  return (parseInt(t / 100) % 24).toString() + ":" + ("0" + (t % 100)).slice(-2)
}

function updateValue(e) {
  const container = document.getElementById("splashes")
  gid = parseInt(document.getElementById("seed").value)
  mday = parseInt(document.getElementById("day").value)
  month = parseInt(document.getElementById("month").value)
  year = parseInt(document.getElementById("year").value)
  locIndex = parseInt(document.getElementById("location").value)
  day = (year - 1) * 28 * 4 + month * 28 + mday
  loc = locations[locIndex]
  function formatDiv(b) {
    return '<div class="splash" style="top:' + (b[2][1] - 1) * 16 + 'px;left:' + (b[2][0] - 1) * 16 + 'px">'
      + time_as_string(b[0]) + '<br>to<br>' + time_as_string(b[1])
      + '</div>'
  }
  bs = bubbles(gid, day, loc[2], loc[3], loc[4])
  document.getElementById("image").src = loc[1]
  container.innerHTML = bs.map(formatDiv).join("\n")
}

let inputs = ["seed", "day", "month", "year", "location"]
for (let i = 0; i < inputs.length; ++i) {
  const input = document.getElementById(inputs[i]);
  input.addEventListener("change", updateValue);
}
</script>

</html>